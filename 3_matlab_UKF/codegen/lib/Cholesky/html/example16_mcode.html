<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="13,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">% Example:</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%profile on</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">function</span> []=example()</span></span>
<span class="srcline"><span class="lineno"><a href="13,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T2:U1"><span class="var type1" id="S2T2U7">n</span>=<span class="mxinfo " id="T2:U3">3</span></span>;      <span class="comment">%number of state</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T2:U4"><span class="var type1" id="S3T2U11">q</span>=<span class="mxinfo " id="T2:U6">1</span></span>;    <span class="comment">%std of process </span></span></span>
<span class="srcline"><span class="lineno"><a href="13,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T2:U7"><span class="var type1" id="S4T2U15">r</span>=<span class="mxinfo " id="T2:U9">1</span></span>;    <span class="comment">%std of measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T1:U10"><span class="var type1" id="S5T1U19">Q</span>=<span class="mxinfo " id="T1:U12"><span class="var type1" id="S3T2U22">q</span>^2*eye(<span class="var type1" id="S2T2U26">n</span>)</span></span>; <span class="comment">% covariance of process</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T2:U15"><span class="var type1" id="S7T2U29">R</span>=<span class="mxinfo " id="T2:U17"><span class="var type1" id="S4T2U31">r</span>^2</span></span>;        <span class="comment">% covariance of measurement  </span></span></span>
<span class="srcline"><span class="lineno"><a href="13,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%f=@(x)[x(2);x(3);0.05*x(1)*(x(2)+x(3))];  % nonlinear state equations</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,10" id="srcline10">10</a></span><span class="line"><span class="comment">%h=@(x)x(1);                               % measurement equation</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T16:U19"><span class="var type1" id="S8T16U35">s</span>=<span class="mxinfo " id="T16:U21">[<span class="mxinfo " id="T2:U22">0</span>;<span class="mxinfo " id="T2:U23">0</span>;<span class="mxinfo " id="T2:U24">1</span>]</span></span>;                                <span class="comment">% initial state</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T16:U25"><span class="var type1" id="S9T16U45">x</span>=<span class="mxinfo " id="T16:U27"><span class="var type1" id="S8T16U47">s</span>+<span class="mxinfo " id="T16:U29"><span class="var type1" id="S3T2U49">q</span>*<span class="mxinfo " id="T16:U31">randn(3,1)</span></span></span></span>; <span class="comment">%initial state          % initial state with noise</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T1:U32"><span class="var type1" id="S11T1U56">P</span> = <span class="mxinfo " id="T1:U34">eye(<span class="var type1" id="S2T2U59">n</span>)</span></span>;                               <span class="comment">% initial state covraiance</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T2:U36"><span class="var type1" id="S12T2U62">N</span>=<span class="mxinfo " id="T2:U38">200</span></span>;                                     <span class="comment">% total dynamic steps</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T17:U39"><span class="var type1" id="S13T17U66">xV</span> = <span class="mxinfo " id="T17:U41">zeros(<span class="var type1" id="S2T2U69">n</span>,<span class="var type1" id="S12T2U70">N</span>)</span></span>;          <span class="comment">%estmate        % allocate memory</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T17:U44"><span class="var type1" id="S15T17U73">sV</span> = <span class="mxinfo " id="T17:U46">zeros(<span class="var type1" id="S2T2U76">n</span>,<span class="var type1" id="S12T2U77">N</span>)</span></span>;          <span class="comment">%actual</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T18:U49"><span class="var type1" id="S16T18U80">zV</span> = <span class="mxinfo " id="T18:U51">zeros(<span class="mxinfo " id="T2:U52">1</span>,<span class="var type1" id="S12T2U84">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,18" id="srcline18">18</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S17T2U87">k</span>=<span class="mxinfo " id="T2:U55">1</span>:<span class="var type1" id="S12T2U90">N</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,19" id="srcline19">19</a></span><span class="line">  <span class="mxinfo " id="T2:U57"><span class="var type1" id="S18T2U93">z</span> = <span class="mxinfo " id="T2:U59"><span class="mxinfo " id="T2:U60"><span class="fcn" id="F113N5:B96">measurement_eq</span>(<span class="var type1" id="S8T16U97">s</span>)</span> + <span class="mxinfo " id="T2:U62"><span class="var type1" id="S4T2U99">r</span>*<span class="mxinfo " id="T2:U64">randn</span></span></span></span>;                     <span class="comment">% measurments</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,20" id="srcline20">20</a></span><span class="line">  <span class="mxinfo " id="T16:U65"><span class="mxinfo " id="T16:U66"><span class="var type1" id="S15T17U105">sV</span>(<span class="mxinfo " id="T19:U68">:</span>,<span class="var type1" id="S17T2U107">k</span>)</span>= <span class="var type1" id="S8T16U108">s</span></span>;                             <span class="comment">% save actual state</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,21" id="srcline21">21</a></span><span class="line">  <span class="mxinfo " id="T2:U71"><span class="mxinfo " id="T2:U72"><span class="var type1" id="S16T18U112">zV</span>(<span class="var type1" id="S17T2U113">k</span>)</span>  = <span class="var type1" id="S18T2U114">z</span></span>;                             <span class="comment">% save measurment</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,22" id="srcline22">22</a></span><span class="line">  [<span class="var type1" id="S9T16U118">x</span>, <span class="var type1" id="S11T1U119">P</span>] = <span class="fcn" id="F226N8:B121">ukf</span>(<span class="var type1" id="S9T16U122">x</span>,<span class="var type1" id="S11T1U123">P</span>,<span class="var type1" id="S18T2U124">z</span>,<span class="var type1" id="S5T1U125">Q</span>,<span class="var type1" id="S7T2U126">R</span>);            <span class="comment">% ekf </span></span></span>
<span class="srcline"><span class="lineno"><a href="13,23" id="srcline23">23</a></span><span class="line">  <span class="mxinfo " id="T16:U83"><span class="mxinfo " id="T16:U84"><span class="var type1" id="S13T17U130">xV</span>(<span class="mxinfo " id="T19:U86">:</span>,<span class="var type1" id="S17T2U132">k</span>)</span> = <span class="var type1" id="S9T16U133">x</span></span>;                            <span class="comment">% save estimate</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,24" id="srcline24">24</a></span><span class="line">  <span class="mxinfo " id="T16:U89"><span class="var type1" id="S8T16U136">s</span> = <span class="mxinfo " id="T16:U91"><span class="mxinfo " id="T16:U92"><span class="fcn" id="F121N6:B139">nonlinear_state_eq</span>(<span class="var type1" id="S8T16U140">s</span>)</span> + <span class="mxinfo " id="T16:U94"><span class="var type1" id="S3T2U142">q</span>*<span class="mxinfo " id="T16:U96">randn(3,1)</span></span></span></span>;                <span class="comment">% update process</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,25" id="srcline25">25</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="13,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,27" id="srcline27">27</a></span><span class="line"><span class="comment">% for k=1:3                                 % plot results</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,28" id="srcline28">28</a></span><span class="line"><span class="comment">%   subplot(3,1,k)</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,29" id="srcline29">29</a></span><span class="line"><span class="comment">%   plot(1:N, sV(k,:), '-', 1:N, xV(k,:), '--')</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,30" id="srcline30">30</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,33" id="srcline33">33</a></span><span class="line"><span class="comment">%profile off</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,34" id="srcline34">34</a></span><span class="line"><span class="comment">%profile viewer</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,35" id="srcline35">35</a></span><span class="line"></span></span>
</pre>

<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="13,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">% Example:</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> []=example()</span></span>
<span class="srcline"><span class="lineno"><a href="13,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%profile on</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T2:U1"><span class="var type1" id="S2T2U7">n</span>=<span class="mxinfo " id="T2:U3">32</span></span>;      <span class="comment">%number of state</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T2:U4"><span class="var type1" id="S3T2U11">q</span>=<span class="mxinfo " id="T2:U6">1</span></span>;    <span class="comment">%std of process </span></span></span>
<span class="srcline"><span class="lineno"><a href="13,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T2:U7"><span class="var type1" id="S4T2U15">r</span>=<span class="mxinfo " id="T2:U9">1</span></span>;    <span class="comment">%std of measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T1:U10"><span class="var type1" id="S5T1U19">Q</span>=<span class="mxinfo " id="T1:U12"><span class="var type1" id="S3T2U22">q</span>^2*eye(<span class="var type1" id="S2T2U26">n</span>)</span></span>; <span class="comment">% covariance of process</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T2:U15"><span class="var type1" id="S7T2U29">R</span>=<span class="mxinfo " id="T2:U17"><span class="var type1" id="S4T2U31">r</span>^2</span></span>;        <span class="comment">% covariance of measurement  </span></span></span>
<span class="srcline"><span class="lineno"><a href="13,10" id="srcline10">10</a></span><span class="line"><span class="comment">%f=@(x)[x(2);x(3);0.05*x(1)*(x(2)+x(3))];  % nonlinear state equations</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,11" id="srcline11">11</a></span><span class="line"><span class="comment">%h=@(x)x(1);                               % measurement equation</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T15:U19"><span class="var type1" id="S8T15U35">s</span>=<span class="mxinfo " id="T15:U21">[<span class="mxinfo " id="T2:U22">2</span>;<span class="mxinfo " id="T2:U23">1</span>;<span class="mxinfo " id="T2:U24">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,13" id="srcline13">13</a></span><span class="line">   <span class="mxinfo " id="T2:U25">1</span>;<span class="mxinfo " id="T2:U26">2</span>;<span class="mxinfo " id="T2:U27">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,14" id="srcline14">14</a></span><span class="line">   <span class="mxinfo " id="T2:U28">1</span>;<span class="mxinfo " id="T2:U29">2</span>;<span class="mxinfo " id="T2:U30">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,15" id="srcline15">15</a></span><span class="line">   <span class="mxinfo " id="T2:U31">1</span>;<span class="mxinfo " id="T2:U32">1</span>;<span class="mxinfo " id="T2:U33">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,16" id="srcline16">16</a></span><span class="line">   <span class="mxinfo " id="T2:U34">3</span>;<span class="mxinfo " id="T2:U35">2</span>;<span class="mxinfo " id="T2:U36">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,17" id="srcline17">17</a></span><span class="line">   <span class="mxinfo " id="T2:U37">1</span>;<span class="mxinfo " id="T2:U38">1</span>;<span class="mxinfo " id="T2:U39">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,18" id="srcline18">18</a></span><span class="line">   <span class="mxinfo " id="T2:U40">5</span>;<span class="mxinfo " id="T2:U41">4</span>;<span class="mxinfo " id="T2:U42">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,19" id="srcline19">19</a></span><span class="line">   <span class="mxinfo " id="T2:U43">1</span>;<span class="mxinfo " id="T2:U44">0</span>;<span class="mxinfo " id="T2:U45">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,20" id="srcline20">20</a></span><span class="line">   <span class="mxinfo " id="T2:U46">1</span>;<span class="mxinfo " id="T2:U47">1</span>;<span class="mxinfo " id="T2:U48">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,21" id="srcline21">21</a></span><span class="line">   <span class="mxinfo " id="T2:U49">1</span>;<span class="mxinfo " id="T2:U50">3</span>;<span class="mxinfo " id="T2:U51">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,22" id="srcline22">22</a></span><span class="line">   <span class="mxinfo " id="T2:U52">1</span>;<span class="mxinfo " id="T2:U53">2</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,23" id="srcline23">23</a></span><span class="line">]</span></span>;                                <span class="comment">% initial state</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T15:U54"><span class="var type1" id="S9T15U103">x</span>=<span class="mxinfo " id="T15:U56"><span class="var type1" id="S8T15U105">s</span>+<span class="mxinfo " id="T15:U58"><span class="var type1" id="S3T2U107">q</span>*<span class="mxinfo " id="T15:U60">randn(32,1)</span></span></span></span>; <span class="comment">%initial state          % initial state with noise</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T1:U61"><span class="var type1" id="S11T1U114">P</span> = <span class="mxinfo " id="T1:U63">eye(<span class="var type1" id="S2T2U117">n</span>)</span></span>;                               <span class="comment">% initial state covraiance</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T2:U65"><span class="var type1" id="S12T2U120">N</span>=<span class="mxinfo " id="T2:U67">5</span></span>;                                     <span class="comment">% total dynamic steps</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T16:U68"><span class="var type1" id="S13T16U124">xV</span> = <span class="mxinfo " id="T16:U70">zeros(<span class="var type1" id="S2T2U127">n</span>,<span class="var type1" id="S12T2U128">N</span>)</span></span>;          <span class="comment">%estmate        % allocate memory</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T16:U73"><span class="var type1" id="S15T16U131">sV</span> = <span class="mxinfo " id="T16:U75">zeros(<span class="var type1" id="S2T2U134">n</span>,<span class="var type1" id="S12T2U135">N</span>)</span></span>;          <span class="comment">%actual</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T17:U78"><span class="var type1" id="S16T17U138">zV</span> = <span class="mxinfo " id="T17:U80">zeros(<span class="mxinfo " id="T2:U81">1</span>,<span class="var type1" id="S12T2U142">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="13,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,32" id="srcline32">32</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S17T2U145">k</span>=<span class="mxinfo " id="T2:U84">1</span>:<span class="var type1" id="S12T2U148">N</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,33" id="srcline33">33</a></span><span class="line">  <span class="mxinfo " id="T2:U86"><span class="var type1" id="S18T2U151">z</span> = <span class="mxinfo " id="T2:U88"><span class="mxinfo " id="T2:U89"><span class="fcn" id="F113N5:B154">measurement_eq</span>(<span class="var type1" id="S8T15U155">s</span>)</span> + <span class="mxinfo " id="T2:U91"><span class="var type1" id="S4T2U157">r</span>*<span class="mxinfo " id="T2:U93">randn</span></span></span></span>;                     <span class="comment">% measurments</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,34" id="srcline34">34</a></span><span class="line">  <span class="mxinfo " id="T15:U94"><span class="mxinfo " id="T15:U95"><span class="var type1" id="S15T16U163">sV</span>(<span class="mxinfo " id="T18:U97">:</span>,<span class="var type1" id="S17T2U165">k</span>)</span>= <span class="var type1" id="S8T15U166">s</span></span>;                             <span class="comment">% save actual state</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,35" id="srcline35">35</a></span><span class="line">  <span class="mxinfo " id="T2:U100"><span class="mxinfo " id="T2:U101"><span class="var type1" id="S16T17U170">zV</span>(<span class="var type1" id="S17T2U171">k</span>)</span>  = <span class="var type1" id="S18T2U172">z</span></span>;                             <span class="comment">% save measurment</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,36" id="srcline36">36</a></span><span class="line">  [<span class="var type1" id="S9T15U176">x</span>, <span class="var type1" id="S11T1U177">P</span>] = <span class="fcn" id="F226N8:B179">ukf</span>(<span class="var type1" id="S9T15U180">x</span>,<span class="var type1" id="S11T1U181">P</span>,<span class="var type1" id="S18T2U182">z</span>,<span class="var type1" id="S5T1U183">Q</span>,<span class="var type1" id="S7T2U184">R</span>);            <span class="comment">% ekf </span></span></span>
<span class="srcline"><span class="lineno"><a href="13,37" id="srcline37">37</a></span><span class="line">  <span class="mxinfo " id="T15:U112"><span class="mxinfo " id="T15:U113"><span class="var type1" id="S13T16U188">xV</span>(<span class="mxinfo " id="T18:U115">:</span>,<span class="var type1" id="S17T2U190">k</span>)</span> = <span class="var type1" id="S9T15U191">x</span></span>;                            <span class="comment">% save estimate</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,38" id="srcline38">38</a></span><span class="line">  <span class="mxinfo " id="T15:U118"><span class="var type1" id="S8T15U194">s</span> = <span class="mxinfo " id="T15:U120"><span class="mxinfo " id="T15:U121"><span class="fcn" id="F121N6:B197">nonlinear_state_eq</span>(<span class="var type1" id="S8T15U198">s</span>)</span> + <span class="mxinfo " id="T15:U123"><span class="var type1" id="S3T2U200">q</span>*<span class="mxinfo " id="T15:U125">randn(32,1)</span></span></span></span>;                <span class="comment">% update process</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,39" id="srcline39">39</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="13,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,41" id="srcline41">41</a></span><span class="line"><span class="comment">% for k=1:3                                 % plot results</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,42" id="srcline42">42</a></span><span class="line"><span class="comment">%   subplot(3,1,k)</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,43" id="srcline43">43</a></span><span class="line"><span class="comment">%   plot(1:N, sV(k,:), '-', 1:N, xV(k,:), '--')</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,44" id="srcline44">44</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,46" id="srcline46">46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="13,47" id="srcline47">47</a></span><span class="line"><span class="comment">%profile off</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,48" id="srcline48">48</a></span><span class="line"><span class="comment">%profile viewer</span></span></span>
<span class="srcline"><span class="lineno"><a href="13,49" id="srcline49">49</a></span><span class="line"></span></span>
</pre>
